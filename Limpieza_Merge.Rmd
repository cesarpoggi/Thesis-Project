---
title: "Base de datos - Merge"
author: "Cesar Poggi"
date: "2023-06-04"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(rio)
library(tidyverse)
library(dplyr)
```


## Limpieza

Objetos con los links de las bases
```{r}
PP2015_pag_html <- "https://www.dropbox.com/s/0l8wp5baa2lwqli/agentes_participantes_2015_pagina.csv?dl=1"
PP2016_pag_html <- "https://www.dropbox.com/s/hijxy0loo02ogsm/agentes_participantes_2016_pagina.csv?dl=1"
PP2017_pag_html <- "https://www.dropbox.com/s/yiufrwyomg52wfs/agentes_participantes_2017_pagina.csv?dl=1"
PP2018_pag_html <- "https://www.dropbox.com/s/9gcvp4ylwnds1yu/agentes_participantes_2018_pagina.csv?dl=1"
PP2020_pag_html <- "https://www.dropbox.com/s/yqkr40yclkp6n1t/agentes_participantes_2020_pagina.csv?dl=1"
```

Importación de las bases desde los objetos
```{r}
PP2015_pag=import(PP2015_pag_html, encoding = 'UTF-8')
PP2016_pag=import(PP2016_pag_html, encoding = 'UTF-8')
PP2017_pag=import(PP2017_pag_html, encoding = 'UTF-8')
PP2018_pag=import(PP2018_pag_html, encoding = 'UTF-8')
PP2020_pag=import(PP2020_pag_html, encoding = 'UTF-8')
```

Quedarnos con variables elementales
```{r}
#list_dfs <- dplyr::lst(PP2015_pag, PP2016_pag, PP2017_pag, PP2018_pag, PP2020_pag)

#list_dfs <- lapply(list_dfs, function(x) x[names(x) == c("tipo_orgn", "orgn")])
#list2env(list_dfs, .GlobalEnv)

#list_dfs2 <- lapply(list_dfs, subset, select = c("orgn", "tipo_orgn"))
#list2env(list_dfs2, .GlobalEnv)

PP2015_pag <- select(PP2015_pag, c("orgn", "tipo_orgn"))
PP2016_pag <- select(PP2016_pag, c("orgn", "tipo_orgn"))
PP2017_pag <- select(PP2017_pag, c("orgn", "tipo_orgn"))
PP2018_pag <- select(PP2018_pag, c("orgn", "tipo_orgn"))
PP2020_pag <- select(PP2020_pag, c("orgn"))
```

Editar variables requeridas
```{r}
#Por ahora solo nombre pero no se utilizará
```

Añadir variables dicotómicas de año (desde 2015 al 2020) a cada base 
```{r}
PP2015_pag$AÑO2015 <- c("1") 
PP2015_pag$AÑO2016 <- c("0") 
PP2015_pag$AÑO2017 <- c("0") 
PP2015_pag$AÑO2018 <- c("0") 
PP2015_pag$AÑO2020 <- c("0") 

PP2016_pag$AÑO2015 <- c("0") 
PP2016_pag$AÑO2016 <- c("1") 
PP2016_pag$AÑO2017 <- c("0") 
PP2016_pag$AÑO2018 <- c("0") 
PP2016_pag$AÑO2020 <- c("0") 

PP2017_pag$AÑO2015 <- c("0") 
PP2017_pag$AÑO2016 <- c("0") 
PP2017_pag$AÑO2017 <- c("1") 
PP2017_pag$AÑO2018 <- c("0") 
PP2017_pag$AÑO2020 <- c("0")

PP2018_pag$AÑO2015 <- c("0") 
PP2018_pag$AÑO2016 <- c("0") 
PP2018_pag$AÑO2017 <- c("0") 
PP2018_pag$AÑO2018 <- c("1") 
PP2018_pag$AÑO2020 <- c("0")

PP2020_pag$AÑO2015 <- c("0") 
PP2020_pag$AÑO2016 <- c("0") 
PP2020_pag$AÑO2017 <- c("0") 
PP2020_pag$AÑO2018 <- c("0") 
PP2020_pag$AÑO2020 <- c("1")
```


Cambio de los strings de las variables para no hayan caracteres especiales
```{r}
#PP2015_pag$nombre <- iconv(PP2015_pag$nombre, to='ASCII//TRANSLIT')
#PP2016_pag$nombre <- iconv(PP2016_pag$nombre, to='ASCII//TRANSLIT')
#PP2017_pag$nombre <- iconv(PP2017_pag$nombre, to='ASCII//TRANSLIT')
#PP2018_pag$nombre <- iconv(PP2018_pag$nombre, to='ASCII//TRANSLIT')
#PP2020_pag$nombre <- iconv(PP2020_pag$nombre, to='ASCII//TRANSLIT')

PP2015_pag$orgn <- iconv(PP2015_pag$orgn, to='ASCII//TRANSLIT')
PP2016_pag$orgn <- iconv(PP2016_pag$orgn, to='ASCII//TRANSLIT')
PP2017_pag$orgn <- iconv(PP2017_pag$orgn, to='ASCII//TRANSLIT')
PP2018_pag$orgn <- iconv(PP2018_pag$orgn, to='ASCII//TRANSLIT')
PP2020_pag$orgn <- iconv(PP2020_pag$orgn, to='ASCII//TRANSLIT')

PP2015_pag$tipo_orgn <- iconv(PP2015_pag$tipo_orgn, to='ASCII//TRANSLIT')
PP2016_pag$tipo_orgn <- iconv(PP2016_pag$tipo_orgn, to='ASCII//TRANSLIT')
PP2017_pag$tipo_orgn <- iconv(PP2017_pag$tipo_orgn, to='ASCII//TRANSLIT')
PP2018_pag$tipo_orgn <- iconv(PP2018_pag$tipo_orgn, to='ASCII//TRANSLIT')
```

Merge de bases
```{r}
df_lista <- list(PP2015_pag, PP2016_pag, PP2017_pag, PP2018_pag, PP2020_pag)

PP_FULL <- df_lista %>%
  reduce(full_join)
```

Reordenar alfabeticamente según nombre de organización
```{r}
PP_FULL$index_OG_col <- row.names(PP_FULL)
PP_FULL<-PP_FULL[order(PP_FULL$orgn),]
```

Cambiar espacio vacios con NA
```{r}
PP_FULL$tipo_orgn <- replace(PP_FULL$tipo_orgn, PP_FULL$tipo_orgn=='', NA)
```

Hacer nueva columna de organización modificada 
```{r}
PP_FULL$orgn_mod <- NA
PP_FULL <- PP_FULL[,c(1,9,2:8)]
```

Poner etiqueda a cada organización manualmente
```{r}
#Para Asentamiento Humano poner AH antes del número que representa una unidad
#Para Asociación de Propietarios AP antes del número que representa una unidad
#Para Vaso de Leche VL antes del número que representa una unidad
#Para Otro Tipo de Org. OR antes del número que representa una unidad



PP_FULL1 <- PP_FULL %>%
  mutate(
    orgn_mod = case_when(index_OG_col == 2040 | index_OG_col == 2041 | index_OG_col == 2503 | index_OG_col == 2625 ~ "AH001.0", #Asentamiento 1ro de Mayo
                         
                         index_OG_col == 1586 | index_OG_col == 1828 | index_OG_col == 2719 | index_OG_col == 2774 | index_OG_col == 2767 | index_OG_col == 2786 ~ "AH002.0", #Asentamiento Oasis de Villa General diferentes grupos y sectores
                         
                         index_OG_col == 391 | index_OG_col == 392 | index_OG_col == 877 | index_OG_col == 878 | index_OG_col == 869 | index_OG_col == 870 | index_OG_col == 445 | index_OG_col == 446 ~ "AH002.1", #Asentamiento Oasis de Villa Junta Directiva Central
                         
                         index_OG_col == 2707 | index_OG_col == 2714 | index_OG_col == 1561 | index_OG_col == 1844 | index_OG_col == 2692 | index_OG_col == 2800 ~ "OR002.0", #Asentamiento Oasis de Villa Asociaciones/Organización de Familias
                         
                         index_OG_col == 1414 | index_OG_col == 1661 ~ "AH003.0", #Asentamiento Lomas de Mamacona Junta Directiva
                          
                         index_OG_col == 2166 | index_OG_col == 2167 | index_OG_col == 2649 | index_OG_col == 2671 ~ "AH003.1", #Asentamiento Lomas de Mamacona diferentes grupos y sectores
                         
                         index_OG_col == 17 | index_OG_col == 18 | index_OG_col == 1841 | index_OG_col == 1842 ~ "AH004.0", #Asentamiento Laureles
                         
                         index_OG_col == 2150 | index_OG_col == 2151 ~ "AH005.0", #Asentamiento Jardines de Pachacamac
                         
                         index_OG_col == 2679 | index_OG_col == 21 | index_OG_col == 22 | index_OG_col == 1050 | index_OG_col == 1051 | index_OG_col == 2172 | index_OG_col == 2173 | index_OG_col == 2661 | index_OG_col == 2673 | index_OG_col == 39 | index_OG_col == 40 | index_OG_col == 1084 | index_OG_col == 1085 | index_OG_col == 2648 ~ "AH006.0", #Asentamiento Principe de Asturias diferentes grupos y sectores
                         
                         index_OG_col == 1550 | index_OG_col == 1840 ~ "AH006.1", #Asentamiento Principe de Asturias Junta Directiva
                         
                         index_OG_col == 1417 | index_OG_col == 1765 ~ "AH007.0", #Asentamiento Valle de Jesús
                         
                         index_OG_col == 2146 | index_OG_col == 2147 | index_OG_col == 3 | index_OG_col == 4 | index_OG_col == 1058 | index_OG_col == 1059 | index_OG_col == 2646 | index_OG_col == 2684 ~ "AH008.0", #Asentamiento Villa del Mar
                
                         index_OG_col == 1421 | index_OG_col == 1786 ~ "AH008.1", #Asentamiento Villa del Mar Junta Directiva
                         
                         index_OG_col == 328 | index_OG_col == 329 | index_OG_col == 1365 | index_OG_col == 1366  ~ "VL008.0", #Vaso de Leche Villa del Mar Comité
                         
                         index_OG_col == 1510 | index_OG_col == 1511 | index_OG_col == 2871 | index_OG_col == 2917 | index_OG_col == 2848 | index_OG_col == 2870  ~ "VL008.1", #Vaso de Leche Villa del Mar Vaso de Leche
                         
                         index_OG_col == 2308  ~ "OR008.0", #Comite de Org. de Obras Villa del Mar
                         
                         index_OG_col == 1428 | index_OG_col == 1654 ~ "OR008.1", #Asociación de Vivienda Villa del Mar
                         
                         index_OG_col == 2286 | index_OG_col == 2287 ~ "AP008.0", #Asociación de Propietarios de Villa del Mar
                         
                         index_OG_col == 2154 | index_OG_col == 2155 | index_OG_col == 1100 ~ "AH009.0", #Asentamiento Humano Virgen de la Candelaria
                         
                         index_OG_col == 2637 | index_OG_col == 2665 | index_OG_col == 27 | index_OG_col == 28 | index_OG_col == 1074 | index_OG_col == 1075 ~ "AH010.0", #Asentamiento Humano Villa Union
                         
                         index_OG_col == 1 | index_OG_col == 2 | index_OG_col == 1299 | index_OG_col == 1300 | index_OG_col == 2298 | index_OG_col == 2299 ~ "OR011.0", #Asociación de pobladores el Buen Samaritano
                         
                         index_OG_col == 5 | index_OG_col == 6 ~ "AH012.0", #Asentamiento Humano 11 de Dic
                         
                         index_OG_col == 858 | index_OG_col == 859 ~ "AH012.1", #Junta Directiva del Asentamiento Humano 11 de Dic
                         
                         index_OG_col == 1064 | index_OG_col == 1065 | index_OG_col == 15 | index_OG_col == 16 ~ "AH013.0", #Asentamiento Humano Brisas de Pachacamac
                         
                         index_OG_col == 2161 ~ "AH013.1", #Comité de Gestión de Obras Asentamiento Humano Brisas de Pachacamac
                         
                         index_OG_col == 7 | index_OG_col == 8 | index_OG_col == 1068 | index_OG_col == 1069 | index_OG_col == 19 | index_OG_col == 20 | index_OG_col == 1029 | index_OG_col == 1030 | index_OG_col == 2630 | index_OG_col == 2652 ~ "AH014.0", #Asentamiento Humano Amp. Max Uhle
                         
                         index_OG_col == 2334 | index_OG_col == 2416 ~ "CP014.0", #Asentamiento Humano Amp. Max Uhle
                         
                         
                         
    ))
```


Poner etiqueta a los tipos de organizaciones según la identificación de palabras clave (Ejem: "vaso de leche", "comedor popular", "agropecuario", etc.)
```{r}

```

Subset de variables: organizaciones y variables de año / tipo de organización y variables de año
```{r}

```

Juntar filas según etiqueta de organizaciones / tipo de organizaciones
```{r}

```

Creación de nueva columna de suma de variables dicotómicas de año
```{r}

```

